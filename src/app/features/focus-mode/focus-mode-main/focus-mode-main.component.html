<ng-container *ngIf="task">
  <div class="task-title">{{task.title}}</div>

  <div class="progress-wrapper">
    <mat-progress-spinner
      [mode]="'determinate'"
      [value]="sessionProgress$|async"
      [strokeWidth]="20"
      [diameter]="150 "
    >
    </mat-progress-spinner>

    <div class="progress-label-wrapper">
      <div
        class="focus-time"
        title="Focus time"
      >
        <!--        {{focusModeTimeToGo / 60000}}min-->
        {{(timeToGo$|async|msToMinuteClockString)}}
      </div>
      <!--      <div class="task-times">-->
      <!--        {{task.timeSpent|msToString}}/{{task.timeEstimate|msToString}}-->
      <!--      </div>-->
    </div>
  </div>

  <section class="controls">
    <!--      <button-->
    <!--        mat-icon-button-->
    <!--        matTooltip="Cancel focus session"-->
    <!--        (click)="cancelFocusSession()"-->
    <!--      >-->
    <!--        <mat-icon>close</mat-icon>-->
    <!--      </button>-->
    <button
      mat-icon-button
      matTooltip="Finish task and select next"
      (click)="finishCurrentTask();"
    >
      <mat-icon>done</mat-icon>
    </button>
    <button
      mat-icon-button
      matTooltip="Get help, when procrastinating"
      (click)="getProcrastinationHelp()"
    >
      <mat-icon>flash_on</mat-icon>
    </button>

    <a
      mat-icon-button
      matTooltip="Open issue in Browser"
      target="_blank"
      *ngIf="task.issueId"
      [href]="issueUrl$|async"
    >
      <div
        *ngIf="task.issuePoints"
        class="mini-badge bgc-primary"
      >
        {{task.issuePoints}}
      </div>
      <mat-icon [svgIcon]="task.issueType|issueIcon"></mat-icon>
    </a>

    <button
      (click)="isShowNotes=!isShowNotes"
      matTooltip="Show/hide task notes and attachments"
      class="ico-btn show-additional-info-btn"
      color=""
      mat-icon-button
    >
      <mat-icon *ngIf="!isShowNotes">chat</mat-icon>
      <mat-icon *ngIf="isShowNotes">expand_less</mat-icon>
    </button>
  </section>

  <div
    class="notes-and-attachments"
    *ngIf="isShowNotes"
    @expand
  >
    <div class="notes-panel">
      <inline-markdown
        (blur)="isFocusNotes=false"
        (blurred)="isFocusNotes=false"
        (changed)="changeTaskNotes($event); isFocusNotes=false"
        [isFocus]="isFocusNotes"
        [isShowControls]="true"
        [model]="task.notes|| defaultTaskNotes"
      ></inline-markdown>
    </div>

    <div
      *ngIf="task.attachments.length"
      class="attachment-list-wrapper"
      @fade
    >
      <task-attachment-list
        [taskId]="task.id"
        [attachments]="task.attachments"
      ></task-attachment-list>
    </div>
  </div>

  <div
    *ngIf="isDragOver"
    class="bgc-accent drag-over-msg"
  >
    <mat-icon>add</mat-icon>
    {{T.F.TASK.CMP.DROP_ATTACHMENT|translate:{title: task.title} }}
  </div>
</ng-container>
